<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rankometer</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        #player-info h2 {
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 10px;
            text-align: center;
        }

        .year-column {
            width: 3.5%;
            display: inline-block;
            vertical-align: top;
            font-size: 0.7em;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .highlight, .highlight ~ div {
            background-color: orange;
            padding: 2px 0;
        }

        input, button {
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
    </style>
</head>

<body>

<div style="text-align: center;">
    <input id="player-names" type="text" placeholder="Enter Player Name..." />
    <button id="search-button" type="button">Search</button>
</div>

<div id="player-info">
    <h2>Rankometer! for <span id="queried-player-name"></span></h2>
    <div id="yearly-ranks">
        <!-- Year columns will be appended here -->
    </div>
</div>

<script>
    function fetchPlayerData(playerName, csvFile) {
        let years = $('#years-active').text().match(/\d{4}/g);
        if (years && years.length == 2) {
            let startYear = parseInt(years[0]);
            let endYear = parseInt(years[1]);

            Papa.parse(csvFile, {
                download: true,
                header: true,
                complete: function(baseballData) {
                    $("#yearly-ranks").empty();
                    for (let year = startYear; year <= endYear; year++) {
                        const playersOfYear = baseballData.data.filter(p => p.Year == year);
                        playersOfYear.sort((a, b) => parseFloat(b.WAR) - parseFloat(a.WAR));
                        const top30Players = playersOfYear.slice(0, 30).map(p => p['Player Name'].split(' ').slice(-1).join(' '));

                        let columnHtml = `<div class="year-column"><strong>${year}</strong><br>`;
                        const playerNameLastName = playerName.split(' ').slice(-1).join(' ').toLowerCase();
                        for (const player of top30Players) {
                            if (player.toLowerCase() === playerNameLastName) {
                                columnHtml += `<div class="highlight">${player}</div>`;
                            } else {
                                columnHtml += `<div>${player}</div>`;
                            }
                        }
                        columnHtml += '</div>';
                        $("#yearly-ranks").append(columnHtml);
                    }
                }
            });
        } else {
            console.error(`Invalid years format for ${playerName}.`);
        }
    }

    function searchPlayer(playerName) {
        Papa.parse('all_players.csv', {
            download: true,
            header: true,
            complete: function(allPlayersData) {
                const player = allPlayersData.data.find(p => p['Player Name'] && p['Player Name'].toLowerCase() === playerName.toLowerCase());

                if (player) {
                    $('#years-active').text(player.Years);
                    $('#queried-player-name').text(playerName);

                    Papa.parse('baseball_pitchers_1900_2024.csv', {
                        download: true,
                        header: true,
                        complete: function(pitchersData) {
                            const isPitcher = pitchersData.data.some(p => p['Player Name'] && p['Player Name'].toLowerCase() === playerName.toLowerCase());

                            if (isPitcher) {
                                fetchPlayerData(playerName, 'baseball_pitchers_1900_2024.csv');
                            } else {
                                fetchPlayerData(playerName, 'baseball_hitters_1900_2024.csv');
                            }
                        }
                    });
                } else {
                    console.error(`Player ${playerName} not found in all_players.csv.`);
                }
            }
        });
    }

    $('#search-button').click(function() {
        const playerName = $('#player-names').val();
        if (playerName) {
            searchPlayer(playerName);
        } else {
            console.error('No player name provided.');
        }
    });
</script>

</body>

</html>
