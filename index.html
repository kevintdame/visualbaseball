<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rankometer</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        .year-column {
.highlighted-player {
    background-color: orange;
    color: white;
}

.players-below {
    background-color: #FFDAB9; /* Lighter orange shade */
}

            width: 3.5%;
            display: inline-block;
            vertical-align: top;
            font-size: 0.7em; /* Adjusting the font size */
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
.highlighted-player {
    background-color: orange;
    color: black;
}

</head>
<body>

<div>
    <input id="player-names" type="text" placeholder="Enter Player Name..." />
    <button id="search-button" type="button">Search</button>
</div>

<div id="player-info">
    <h2>Player Info</h2>
    <p>Years Active: <span id="years-active"></span></p>
    <div id="yearly-ranks">
        <!-- Year columns will be appended here -->
    </div>
</div>

<script>
const generateColumns = async (playerName) => {
    const allPlayersResponse = await fetch('all_players.csv');
    const allPlayersData = await allPlayersResponse.text();
    const parsedAllPlayersData = Papa.parse(allPlayersData, { header: true, skipEmptyLines: true });
    const player = parsedAllPlayersData.data.find(p => p['Player Name'].toLowerCase() === playerName.toLowerCase());

    if (!player) {
        console.error("Player not found:", playerName);
        return;
    }

    const yearsPlayed = player.Years.split(',').map(year => parseInt(year.trim()));

    const response = await fetch('baseball_pitchers_1900_2024.csv');
    const data = await response.text();
    const parsedData = Papa.parse(data, { header: true, skipEmptyLines: true });

    const yearlyRanksElem = document.querySelector('.yearly-ranks');

    for (const year of yearsPlayed) {
        const playersForYear = parsedData.data.filter(p => parseInt(p.Year) === year);
        const columnElem = document.createElement('div');
        columnElem.className = 'year-column';
        
        let playerFound = false;
        for (const playerData of playersForYear) {
            const playerNameElem = document.createElement('div');
            playerNameElem.className = 'player';
            playerNameElem.innerText = playerData.Player.split(' ').pop();  // Displaying only last name
            
            if (playerNameElem.innerText.toLowerCase() === playerName.split(' ').pop().toLowerCase() || playerFound) {
                playerNameElem.style.backgroundColor = 'orange';
                playerNameElem.style.color = 'black';
                playerFound = true;
            }
            
            columnElem.appendChild(playerNameElem);
        }
        
        yearlyRanksElem.appendChild(columnElem);
    }
}

// Event listener for the search button
document.querySelector('#search-btn').addEventListener('click', function() {
    const playerName = document.querySelector('#player-name-input').value;
    document.querySelector('.yearly-ranks').innerHTML = '';  // Clear previous columns
    generateColumns(playerName);
});
</script>

</body>
</html>
