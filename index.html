<!DOCTYPE html>
<html lang="en">
<head>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rankometer</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>

        html, body {
    margin: 0;
    padding: 0;
    background-color: black;
        
}

        body {
    background-color: black;
}

#player-names, #search-button {
    margin-top: 0;
    margin-bottom: 0;
}

        svg {
    margin: 0;
}

      
#search-container {
    display: flex;
    align-items: center; 
    width: auto;
    padding: 5px;
    margin-top: 20px; /* Adjust this value based on how much you want to move the search bar downwards */

}

#player-names {
    height: 40px;  
    padding: 0;  /* Remove padding */
    line-height: 40px;  /* Center the text vertically */    width: 250px; /* Adjusted width */
    border: 1px solid black; 
    outline: none; 
    color: gray; 
    border-radius: 0; /* Reset border-radius */
    font-size: 18px; /* Makes the text inside the box larger */

}

#search-button {
    display: flex;
    justify-content: center; /* Horizontally center the icon */
    align-items: center; /* Vertically center the icon */
    background-color: white;
    border: 1px solid black; 
    height: 43px; /* Match the height of the search box */
    /* padding: 0 5px; Minimal horizontal padding */
}

#search-button img {
    height: 25px;  /* Slightly smaller to ensure it's centered */
    width: auto;
    margin: 0;

}




#player-names:focus {
    color: gray; /* Ensures text color remains gray when focused */
}




        
input[type="text"] {
    width: 400px; /* Adjust as needed */
    height: 50px; /* Adjust as needed */
    font-size: 24px; /* Makes the text inside the box larger */
    margin-left: 5%; /* Left-aligns the box with the rest of your content */
    margin-top: 30px; /* Pushes the search box down. Adjust this value as needed */
    background-color: white; /* Makes the search box white */
}



        footer {
     text-align: left;
    margin-left: 5%;
    background-color: 0;  /* This is a dark gray; adjust as desired */
}

        
#headshot {
    width: 100px;  /* Adjust based on the size of your headshot */
    border-radius: 50%;  /* Makes the image circular */
    margin-right: 20px;
    margin-left: 5%;

}

        
header {
    text-align: left;
    background-color: #000; /* Dark black background */
    padding-left: 20px; /* Left padding to ensure content doesn't stick to the edge */
    padding-top: 15px;  /* Increase this value for more height */
    padding-bottom: 15px;  /* Increase this value for more height */

}







        
        #content-area {
    background-color: black;  /* This is a light gray; adjust as desired */
    margin: 20px 5%;  /*This adds top/bottom margin and sets left/right margin to 5% of viewport width */
    margin-left: 5%; 
    padding: 20px;
}

#logo {
    width: 300px;  /* You can adjust this based on the desired size of your logo */
    margin-right: 50px; /* Space between the logo and any other content in the header */
        margin-left: 4%;
}

       
.year-column strong {
    font-size: 1.2em; /* Adjust this value to your desired font size */
    /* any other existing styles for this selector */
}

        #yearly-ranks {   /* Pushing the visualizations down */
    margin-top: 5vh;
    margin-left: 5%;
    background-color: black
}

        #rankometer-header {
    margin-top: 2vh; /* Adjust this value as needed */
    margin-left: 5%;

}

#player-info h2 {
    color: black;
}

#player-info p {
    color: black;
}

        
body {
    background-color: #888888;
    color: black;
    font-family: 'Helvetica', sans-serif;
}

.player-name {
    color: #444444;
}

input, button {
    background-color: #333;  /* Dark gray background */
    color: white;            /* White text */
    border: 1px solid white; /* White border */
}

        
        #rankometer-header {
    font-size: 50px;  /* Adjust this value to your preferred font size */
    margin-bottom: 5px;
    margin-left: 5%;

}

#player-info p {
    margin-top: 60;      /* Remove top margin */
    margin-bottom: 60px; /* Adjust as needed for more space below the subtitle */
    margin-left: 5%;

}


        
.highlighted-player, .subsequent-player, .player-name {
    display: inline-block;
    margin-bottom: 3px;  /* Adjust as needed */
    text-align: center;
    line-height: 1.2;  /* Adjust as needed */
    width: 95%;
    padding: 2px 4.5px;  /* This ensures a consistent vertical size */

}




.highlighted-player, .subsequent-player {
    padding-left: 3px;  /* Decrease the left padding slightly */
    padding-right: 7px; /* Increase the right padding slightly */
    background-color: orange;
    color: black; /* Change the text color to black for better contrast against the orange background */

}



        .player-name {
    line-height: 1.2;
}

.year-column {
    width: 3.5%;
    display: inline-block;
    vertical-align: top;
    font-size: 0.7em; /* Adjusting the font size */
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;  /* Center-align content */
    margin-right: 10px;  /* Adjust this value based on the desired spacing */
    color: orange;

}

    </style>
</head>
<body>

<header>
    <img src="kevindamebaseball_logo.png" alt="Your Logo" id="logo">
</header>

    
<div id="search-container">
    <input id="player-names" type="text" placeholder=" Enter Player Name..." />
    <button id="search-button" type="button">
        <img src="search_icon.png" alt="Search">
    </button>
</div>



<div id="player-info">
<h2 id="rankometer-header">Rankometer</h2>
    <p>Top 30 Players by WAR: <span id="years-active"></span></p>
    <div id="content-area">
        <div id="yearly-ranks">
            <!-- Year columns will be appended here -->
        </div>
    </div>
</div>

<script>

function fetchPlayerData(playerName, csvFileName) {
    Papa.parse(csvFileName, {
        download: true,
        header: true,
        complete: function(data) {
            $("#yearly-ranks").empty();
            const years = $('#years-active').text().match(/\d{4}/g);
            const startYear = parseInt(years[0]);
            const endYear = parseInt(years[1]);
            for(let year = startYear; year <= endYear; year++) {
                const playerNameLower = playerName.toLowerCase();
                const playersOfYear = data.data.filter(p => p.Year == year);
                playersOfYear.sort((a, b) => parseFloat(b.WAR) - parseFloat(a.WAR));
                const top30Players = playersOfYear.slice(0, 30).map(p => p['Player Name'].split(' ').slice(-1).join(' ').trim()); // Taking only the last name
                let columnHtml = `<div class="year-column">`;
                const searchedLastName = playerName.split(" ").pop().toLowerCase();
                let highlightFound = false;

                for(const player of top30Players) {
                    if (player.toLowerCase() === searchedLastName) {
                        columnHtml += `<span class="highlighted-player">${player}</span><br>`;
                        highlightFound = true;
                    } else if (highlightFound) {
                        columnHtml += `<span class="subsequent-player">${player}</span><br>`;
                    } else {
                        columnHtml += `<span class="player-name">${player}</span><br>`;
                    }
                }

                columnHtml += `<strong>${year}</strong><br>`;
                columnHtml += '</div>';
                $("#yearly-ranks").append(columnHtml);
            }
            captureVisualization();
        }
    });
}

function searchPlayer(playerName) {
    Papa.parse('all_players.csv', {
        download: true,
        header: true,
        complete: function(allPlayersData) {
            const playersWithName = allPlayersData.data.filter(p => p['Player Name'] && p['Player Name'].toLowerCase() === playerName.toLowerCase());

            if (playersWithName.length > 0) {
                playersWithName.sort((a, b) => {
                    const aYears = a.Years.match(/\d{4}/g) || [];
                    const bYears = b.Years.match(/\d{4}/g) || [];
                    return (bYears[1] - bYears[0]) - (aYears[1] - aYears[0]);
                });

                const player = playersWithName[0];
                $('#years-active').text(player.Years.replace('+ (', ''));
                $('#rankometer-header').text(`Rankometer for ${playerName}`);

                // Fetch data from both CSVs and determine which one to use based on the frequency of the player's name.
                let pitcherCount = 0;
                let hitterCount = 0;

                Papa.parse('baseball_pitchers_1900_2024.csv', {
                    download: true,
                    header: true,
                    complete: function(pitchersData) {
                        pitcherCount = pitchersData.data.filter(p => p['Player Name'] && p['Player Name'].toLowerCase() === playerName.toLowerCase()).length;

                        Papa.parse('baseball_hitters_1900_2024.csv', {
                            download: true,
                            header: true,
                            complete: function(hittersData) {
                                hitterCount = hittersData.data.filter(p => p['Player Name'] && p['Player Name'].toLowerCase() === playerName.toLowerCase()).length;

                                // Choose the CSV where the player appears most frequently.
                                if (pitcherCount >= hitterCount) {
                                    fetchPlayerData(playerName, 'baseball_pitchers_1900_2024.csv');
                                } else {
                                    fetchPlayerData(playerName, 'baseball_hitters_1900_2024.csv');
                                }
                            }
                        });
                    }
                });
            } else {
                console.warn(`Player "${playerName}" not found in all_players.csv.`);
            }
        },
        error: function(error) {
            console.error('Error accessing all_players CSV:', error);
        }
    });
}



    
$('#search-button').click(function() {
    const playerName = $('#player-names').val();
    searchPlayer(playerName);
});


// This function captures the visualization as an image
function captureVisualization() {
    html2canvas(document.querySelector("#yearly-ranks")).then(canvas => {
        // Convert the canvas to a PNG data URL
        const imageUrl = canvas.toDataURL("image/png");
        
        // Create an anchor tag and image tag
        const anchor = document.createElement('a');
        const img = document.createElement('img');
        
        // Set the href of the anchor tag to the image URL and open in a new tab
        anchor.href = imageUrl;
        anchor.target = '_blank';
        
        // Set the src of the image tag to the image URL
        img.src = imageUrl;
        
        // Append the image to the anchor and then replace the visualization with the anchor
        anchor.appendChild(img);
        const visualizationContainer = document.querySelector("#yearly-ranks");
        visualizationContainer.parentNode.replaceChild(anchor, visualizationContainer);
    });
}



    
    // Set default player visual for Babe Ruth
document.addEventListener("DOMContentLoaded", function() {
    searchPlayer('Babe Ruth');
});

    
</script>

    <footer>
    <img src="headshot.png" alt="Your Headshot" id="headshot">
    <p>Your Name and any other info you want here</p>
</footer>

</body>
</html>
